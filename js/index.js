!function(e){var n={};function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(o,a,function(n){return e[n]}.bind(null,a));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";function o(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}!function(){document.getElementById("button").addEventListener("click",(function(){var e={content:document.querySelector(".input-box > input").value||"武汉加油",province_id:+u.province_id};if(/@和谐:\d+/.test(e.content))s("index/correctMes?province_id="+ +e.content.split(":")[1]+"&key=2020武汉加油",{credentials:"include"}).then((function(e){console.log(e),console.log("删除成功!")}));else if(u.province_id&&e.content.length<22)s("api/message",{method:"POST",credentials:"include",body:"content="+e.content+"&province_id="+e.province_id,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){console.log(e),document.querySelector(".input-box > input").value="",window.location="./share.html",window.sessionStorage.setItem("grobal",JSON.stringify(u))}));else{if(e.content.length>=22){var n=document.createElement("div");n.style.cssText="\n        padding:2vw;\n        font-size:3vw;\n        color:white;\n        background-color:black;\n        position:absolute;\n        bottom:5vw;\n        left:50%;\n        transform:translate(-50%, -50%);\n        border-radius:2vw;\n        ",n.innerHTML="字数太多了哦",document.body.append(n),setTimeout((function(){document.body.removeChild(n)}),2e3)}console.log("正在获取省份中")}}));var e,n,t,a=echarts.init(document.getElementById("china-map")),i=["#29454c","#4c6b73","#819d9e","#b2ced8","#ced3e0","#eeeeee"],r=[{name:"北京",value:0},{name:"天津",value:0},{name:"上海",value:0},{name:"重庆",value:0},{name:"河北",value:0},{name:"河南",value:0},{name:"云南",value:0},{name:"辽宁",value:0},{name:"黑龙江",value:0},{name:"湖南",value:0},{name:"安徽",value:0},{name:"山东",value:0},{name:"新疆",value:0},{name:"江苏",value:0},{name:"浙江",value:0},{name:"江西",value:0},{name:"湖北",value:0},{name:"广西",value:0},{name:"甘肃",value:0},{name:"山西",value:0},{name:"内蒙古",value:0},{name:"陕西",value:0},{name:"吉林",value:0},{name:"福建",value:0},{name:"贵州",value:0},{name:"广东",value:0},{name:"青海",value:0},{name:"西藏",value:0},{name:"四川",value:0},{name:"宁夏",value:0},{name:"海南",value:0},{name:"台湾",value:0},{name:"香港",value:0},{name:"澳门",value:0},{name:"南沙诸岛",value:0}],l=[{id:1,name:"北京市"},{id:2,name:"天津市"},{id:3,name:"上海市"},{id:4,name:"重庆市"},{id:5,name:"河北省"},{id:6,name:"山西省"},{id:7,name:"辽宁省"},{id:8,name:"吉林省"},{id:9,name:"黑龙江省"},{id:10,name:"江苏省"},{id:11,name:"浙江省"},{id:12,name:"安徽省"},{id:13,name:"福建省"},{id:14,name:"江西省"},{id:15,name:"山东省"},{id:16,name:"河南省"},{id:17,name:"湖北省"},{id:18,name:"湖南省"},{id:19,name:"广东省"},{id:20,name:"海南省"},{id:21,name:"四川省"},{id:22,name:"贵州省"},{id:23,name:"云南省"},{id:24,name:"陕西省"},{id:25,name:"甘肃省"},{id:26,name:"青海省"},{id:27,name:"台湾省"},{id:28,name:"内蒙古"},{id:29,name:"广西"},{id:30,name:"西藏"},{id:31,name:"宁夏"},{id:32,name:"新疆"},{id:33,name:"香港"},{id:34,name:"澳门"},{id:35,name:"海外"}];window.addEventListener("pageshow",(function(){sessionStorage.getItem("need-refresh")&&(location.reload(),sessionStorage.removeItem("need-refresh"))})),e=document.body.clientWidth,n=document.body.clientHeight,document.querySelector(".foot-box").style.marginTop="calc("+n+"px - 182vw)",document.querySelector(".barrage-box").style.top=+e/100*55+"px",t={title:{text:"",left:"center"},tooltip:{trigger:"item",formatter:"{b}<br/>{c}人助力"},visualMap:{show:!0,x:"left",y:"50%",itemWidth:10,itemHeight:10,textStyle:{fontSize:10},splitList:[{start:5e3,end:1/0},{start:1001,end:5e3},{start:101,end:1e3},{start:11,end:100},{start:1,end:10},{start:0,end:0}],color:i},series:[{name:"中国",type:"map",mapType:"china",roam:!1,data:r,top:"3%",zoom:1.1,selectedMode:"single",label:{normal:{show:!0,textStyle:{color:"#636260",fontSize:6,fontWeight:"bold"}},emphasis:{show:!1,textStyle:{color:"#000"}}},itemStyle:{normal:{borderWidth:.5,borderColor:"#e1e596",color:function(e){var n=e.data.value;return i[n>5e3?0:n>1e3?1:n>100?2:n>10?3:n>0?4:5]}},emphasis:{borderWidth:.5,borderColor:"#e1e596",color:function(e){var n=e.data.value;return i[n>5e3?0:n>1e3?1:n>100?2:n>10?3:n>0?4:5]}}}}]},a.setOption(t),a.off("click");var d="https://whcomeon.100steps.top/",c=window.location.href,u={avatar:"",rootUrl:"",province:"",province_id:"",latitude:0,longitude:0,last_id:0,option:""},m=[];function s(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(d+e,n).then((function(e){if(401!==e.status)return e.json();console.log("重新登录"),window.location=d+"/auth/jump?redirect="+c})).catch((function(e){console.log(e)}))}s("api/index",{credentials:"include"}).then((function(e){console.log(e),u.avatar=e.avatar,e.id,0!==e.province_id?(u.latitude=e.latitude,u.longitude=e.longitude,u.province_id=e.province_id):(console.log("error!"),function e(){3===(e.index=0)&&(alert("获取地区信息失败,请刷新网页!"),location=window.location.href),s("index/reLocation",{}).then((function(e){return e.json()})).then((function(n){0!==n.province_id?(u.latitude=n.latitude,u.longitude=n.longitude,u.province_id=n.province_id):(e.index++,e())}))}()),u.latitude=e.latitude,u.longitude=e.longitude,u.province_id=e.province_id,u.last_id=e.message[e.message.length-1].id,l.map((function(e){e.id===u.province_id&&(u.province=e.name)})),console.log(u);var n=e.province.map((function(e){return{name:/省/.test(e.name)?e.name.replace("省",""):/市/.test(e.name)?e.name.replace("市",""):e.name,value:e.mes_amount}}));console.log(n),u.option=n;var t=n.reduce((function(e,n){return e+ +n.value}),0);document.querySelector(".relay").innerHTML="共 "+t+" 人接力",a.setOption({series:[{name:"中国",data:n,itemStyle:{normal:{areaColor:function(e){var n=e.data.value;return i[n>1e4?0:n>1e3?1:n>100?2:n>10?3:4]}},emphasis:{borderWidth:.5,borderColor:"#0550c3",color:function(e){var n=e.data.value;return i[n>1e4?0:n>1e3?1:n>100?2:n>10?3:4]}}}}]}),a.off("click"),function e(n){m=m.concat(n);var t=document.querySelectorAll(".barrage");function a(e){var n=document.createElement("div");n.innerHTML=e;n.children;return n.children}for(var i=0;i<4;i++)document.querySelectorAll(".barrage")[i].innerHTML=i%2?"\n        <div>\n          \n        </div>\n        ":'\n        <div>\n          <div class="barrage-item" style="background-color: rgba(0,0,0,0)"></div>\n        </div>\n        ',console.log("数据清空!"),console.log(document.querySelectorAll(".barrage")[i]);for(var r=0;r<m.length;r++){var l;(l=t[r%4].children[0]).append.apply(l,o(a('\n        <div class="barrage-item">\n          <div class="portait"><img src="'+n[r].user_avatar+'"/></div>\n          <div class="text">'+n[r].content+"</div>\n        </div>\n      ")))}m.splice(0,16),console.log(m),console.log(document.querySelectorAll(".barrage-item")),setTimeout((function(){s("api/index/mes?last_id="+u.last_id,{credentials:"include"}).then((function(t){console.log(t),console.log(t.message),u.last_id=t.message[t.message.length-1].id,n=t.message,console.log(n),e(n)}))}),28e3)}(e.message)}))}()}]);
//# sourceMappingURL=index.js.map